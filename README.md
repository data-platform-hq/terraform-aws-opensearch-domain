# AWS OpenSearch domain Terraform module
Terraform module for AWS OpenSearch domain creation

## Usage

```hcl
module "opensearch_domain" {
  source  = "data-platform-hq/opensearch-domain/aws"
  version = "~> 1.0"
  
  domain_name = "dev-es-domain"
  engine_version = "OpenSearch_2.5"
  advanced_options = {
    "rest.action.multi.allow_explicit_index": "true"
  }
  cluster_config = {
    dedicated_master_count = 3
    availability_zones = 3
    dedicated_master_type = "t3.medium.search"
    instance_type = "t3.medium.search"
  }
  ebs_enabled = true
  vpc_enabled = true
  subnet_ids = ["subnet-12345678", "subnet-87654321", "subnet-12387645"]
  tags = {
    Environment = "dev"
    Terraform   = "true"
  }
  domain_policy = {
    enabled = true
    actions = ["es:*"]
    principals = [
      {
        type        = "*"
        identifiers = ["*"]
      }
    ]
  }
}
```

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name                                                                        | Version  |
|-----------------------------------------------------------------------------|----------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform)   | >= 1.0   |
| <a name="requirement_aws"></a> [aws](#requirement\_aws)                     | >= 5.0.1 |

## Providers

| Name                                                | Version   |
|-----------------------------------------------------|-----------|
| <a name="provider_aws"></a> [aws](#provider\_aws)   | >= 5.0.1  |

## Modules

No modules.

## Resources

| Name                                                                                                                                                                   | Type        |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| [aws_caller_identity.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/caller_identity)                                          | data source |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region)                                                            | data source |
| [aws_opensearch_domain.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/opensearch_domain)                                            | resource    |
| [aws_opensearch_domain_saml_options.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/opensearch_domain_saml_options)                  | resource    |
| [aws_iam_policy_document.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document )                                    | data source |
| [aws_opensearch_domain_policy.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/opensearch_domain_policy)                              | resource    |
| [aws_opensearch_outbound_connection.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/opensearch_outbound_connection)                  | resource    |
| [aws_opensearch_inbound_connection_accepter.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/opensearch_inbound_connection_accepter)  | resource    |

## Inputs

| Name                                                                                                                                                                                                                  | Description                                                                                                                                                                            | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Default                                                                                  | Required |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|:--------:|
| <a name="input_create"></a> [create](#input\_create)                                                                                                                                                                  | Controls if resources should be created (affects nearly all resources)                                                                                                                 | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `true`                                                                                   |    no    |
| <a name="input_tags"></a> [tags](#input\_tags)                                                                                                                                                                        | A map of tags to add to all resources                                                                                                                                                  | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `{}`                                                                                     |    no    |
| <a name="input_domain_name"></a> [domain\_name](#input\_domain\_name)                                                                                                                                                 | Name of the OpenSearch domain                                                                                                                                                          | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | n/a                                                                                      |   yes    |
| <a name="input_engine_version"></a> [engine\_version](#input\_engine\_version)                                                                                                                                        | Version of OpenSearch to deploy                                                                                                                                                        | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `OpenSearch_2.5`                                                                         |    no    |
| <a name="input_advanced_options"></a> [advanced\_options](#input\_advanced\_options)                                                                                                                                  | Key-value string pairs to specify advanced configuration options                                                                                                                       | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `{}`                                                                                     |    no    |
| <a name="input_advanced_security_options_enabled"></a> [advanced\_security\_options\_enabled](#input\_advanced\_security\_options\_enabled)                                                                           | Whether advanced security is enabled                                                                                                                                                   | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                  |    no    |
| <a name="input_advanced_security_options_anonymous_auth_enabled"></a> [advanced\_security\_options\_anonymous\_auth\_enabled](#input\_advanced\_security\_options\_anonymous\_auth\_enabled)                          | Whether Anonymous auth is enabled                                                                                                                                                      | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                  |    no    |
| <a name="input_advanced_security_options_internal_user_database_enabled"></a> [advanced\_security\_options\_internal\_user\_database\_enabled](#input\_advanced\_security\_options\_internal\_user\_database\_enabled) | Whether the internal user database is enabled                                                                                                                                          | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                  |    no    |
| <a name="input_advanced_security_options_master_user_arn"></a> [advanced\_security\_options_\master\_user\_arn](#input\_advanced_security\_options\_master\_user\_arn)                                                | ARN for the main user. If not specified, then it defaults to using the IAM user that is making the request                                                                             | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `""`                                                                                     |    no    |
| <a name="input_advanced_security_options_master_user_name"></a> [advanced\_security\_options\_master\_user\_name](#input\_advanced\_security\_options\_master\_user\_name)                                            | Main user's username, which is stored in the Amazon OpenSearch Service domain's internal database. Applicable if advanced_security_options_internal_user_database_enabled set to true  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `""`                                                                                     |    no    |
| <a name="input_advanced_security_options_master_user_password"></a> [advanced\_security\_options\_master\_user\_password](#input\_advanced\_security\_options\_master\_user\_password)                                | Main user's password, which is stored in the Amazon OpenSearch Service domain's internal database. Applicable if advanced_security_options_internal_user_database_enabled set to true  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `""`                                                                                     |    no    |
| <a name="input_auto_tune_options_enabled"></a> [auto\_tune\_options\_enabled](#input\_auto\_tune\_options\_enabled)                                                                                                   | Whether auto tune options are enabled                                                                                                                                                  | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                  |    no    |
| <a name="input_auto_tune_options_rollback_on_disable"></a> [auto\_tune\_options\_rollback\_on\_disable](#input\_auto\_tune\_options\_rollback\_on\_disable)                                                           | Whether to roll back to default Auto-Tune settings when disabling Auto-Tune                                                                                                            | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `NO_ROLLBACK`                                                                            |    no    |
| <a name="input_auto_tune_options_maintenance_schedule_cron_expression"></a> [auto\_tune\_options\_maintenance\_schedule\_cron\_expression](#input\_auto\_tune\_options\_maintenance\_schedule\_cron\_expression)      | A cron expression specifying the recurrence pattern for an Auto-Tune maintenance schedule                                                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `""`                                                                                     |    no    |
| <a name="input_auto_tune_options_maintenance_schedule_start_at"></a> [auto\_tune\_options\_maintenance\_schedule\_start\_at](#input\_auto\_tune\_options\_maintenance\_schedule\_start\_at)                           | Date and time at which to start the Auto-Tune maintenance schedule in RFC3339 format                                                                                                   | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `""`                                                                                     |    no    |
| <a name="input_auto_tune_options_maintenance_schedule_duration_value"></a> [auto\_tune\_options\_maintenance\_schedule\_duration\_value](#input\_auto\_tune\_options\_maintenance\_schedule\_duration\_value)         | An integer specifying the value of the duration of an Auto-Tune maintenance window                                                                                                     | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `0`                                                                                      |    no    |
| <a name="input_cluster_config"></a> [cluster\_config](#input\_cluster\_config)                                                                                                                                        | Cluster configuration                                                                                                                                                                  | <pre>object({<br>   cold_storage_options_enabled = optional(bool, false) <br>   dedicated_master_enabled     = optional(bool, true) <br>   dedicated_master_count       = optional(number, 3)<br>   dedicated_master_type        = optional(string, "m6g.large.search") <br>   instance_count               = optional(number, 3) <br>   instance_type                = optional(string, "r6g.large.search") <br>   warm_enabled                 = optional(bool, false)<br>   warm_count                   = optional(number, 2)<br>   warm_type                    = optional(string, "ultrawarm1.medium.search")<br>   availability_zones           = optional(number, 3)<br>})</pre> | `{}`                                                                                     |    no    |
| <a name="input_cognito_options_enabled"></a> [cognito\_options\_enabled](#input\_cognito\_options\_enabled)                                                                                                           | Whether Amazon Cognito authentication with Kibana is enabled or not                                                                                                                    | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                  |    no    |
| <a name="input_cognito_options"></a> [cognito\_options](#input\_cognito\_options)                                                                                                                                     | Configuration block for authenticating Kibana with Cognito                                                                                                                             | <pre>object({<br>   identity_pool_id = string<br>   role_arn         = string<br>   user_pool_id     = string<br>})</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | <pre>{<br> "identity_pool_id": "",<br> "role_arn": "",<br> "user_pool_id": ""<br>}</pre> |    no    |
| <a name="input_domain_endpoint_enforce_https"></a> [domain\_endpoint\_enforce\_https](#input\_domain\_endpoint\_enforce\_https)                                                                                       | Whether or not to require HTTPS                                                                                                                                                        | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `true`                                                                                   |    no    |
| <a name="input_domain_endpoint_tls_security_policy"></a> [domain\_endpoint\_tls\_security\_policy](#input\_domain\_endpoint\_tls\_security\_policy)                                                                   | Name of the TLS security policy that needs to be applied to the HTTPS endpoint. Valid values: Policy-Min-TLS-1-0-2019-07 and Policy-Min-TLS-1-2-2019-07                                | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `"Policy-Min-TLS-1-2-2019-07"`                                                           |    no    |
| <a name="input_domain_endpoint_custom_endpoint_enabled"></a> [domain\_endpoint\_custom\_endpoint\_enabled](#input\_domain\_endpoint\_custom\_endpoint\_enabled)                                                       | Whether to enable custom endpoint for the OpenSearch domain                                                                                                                            | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                  |    no    |
| <a name="input_domain_endpoint_custom_endpoint"></a> [domain\_endpoint\_custom\_endpoint](#input\_domain\_endpoint\_custom\_endpoint)                                                                                 | Fully qualified domain for your custom endpoint                                                                                                                                        | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `""`                                                                                     |    no    |
| <a name="input_domain_endpoint_custom_endpoint_certificate_arn"></a> [domain\_endpoint\_custom\_endpoint\_certificate\_arn](#input\_domain\_endpoint\_custom\_endpoint\_certificate\_arn)                             | ACM certificate ARN for your custom endpoint                                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `""`                                                                                     |    no    |
| <a name="input_ebs_enabled"></a> [ebs\_enabled](#input\_ebs\_enabled)                                                                                                                                                 | Whether EBS volumes are attached to data nodes in the domain                                                                                                                           | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                  |    no    |
| <a name="input_ebs_iops"></a> [ebs\_iops](#input\_ebs\_iops)                                                                                                                                                          | Baseline input/output (I/O) performance of EBS volumes attached to data nodes. Applicable only for the GP3 and Provisioned IOPS EBS volume types                                       | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `3000`                                                                                   |    no    |
| <a name="input_ebs_throughput"></a> [ebs\_throughput](#input\_ebs\_throughput)                                                                                                                                        | (Required if volume_type is set to gp3) Specifies the throughput (in MiB/s) of the EBS volumes attached to data nodes. Applicable only for the gp3 volume type                         | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `125`                                                                                    |    no    |
| <a name="input_ebs_volume_size"></a> [ebs\_volume\_size](#input\_ebs\_volume\_size)                                                                                                                                   | (Required if ebs_enabled is set to true.) Size of EBS volumes attached to data nodes (in GiB)                                                                                          | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `10`                                                                                     |    no    |
| <a name="input_ebs_volume_type"></a> [ebs\_volume\_type](#input\_ebs\_volume\_type)                                                                                                                                   | Type of EBS volumes attached to data nodes                                                                                                                                             | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `"gp3"`                                                                                  |    no    |
| <a name="input_encrypt_at_rest_enabled"></a> [encrypt\_at\_rest\_enabled](#input\_encrypt\_at\_rest\_enabled)                                                                                                         | Whether to enable encryption at rest                                                                                                                                                   | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `true`                                                                                   |    no    |
| <a name="input_encrypt_at_rest_kms_key_id"></a> [encrypt\_at\_rest\_kms\_key\_id](#input\_encrypt\_at\_rest\_kms\_key\_id)                                                                                            | KMS key ARN to encrypt the OpenSearch domain with                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `""`                                                                                     |    no    |
| <a name="input_log_publishing_options"></a> [log\_publishing\_options](#input\_log\_publishing\_options)                                                                                                              | Configuration block for publishing slow and application logs to CloudWatch Logs                                                                                                        | <pre>list(object({<br>  enabled                  = optional(bool, true)<br>  cloudwatch_log_group_arn = string<br>  log_type                 = string<br>}))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `[]`                                                                                     |    no    |
| <a name="input_node_to_node_encryption_enabled"></a> [node\_to\_node\_encryption\_enabled](#input\_node\_to\_node\_encryption\_enabled)                                                                               | Whether to enable node-to-node encryption                                                                                                                                              | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `true`                                                                                   |    no    |
| <a name="input_vpc_enabled"></a> [vpc\_enabled](#input\_vpc\_enabled)                                                                                                                                                 | Whether the cluster is running inside a VPC                                                                                                                                            | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                  |    no    |
| <a name="input_subnet_ids"></a> [subnet\_ids](#input\_subnet\_ids)                                                                                                                                                    | The list of VPC subnet IDs to use                                                                                                                                                      | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `[]`                                                                                     |    no    |
| <a name="input_security_group_ids"></a> [security\_group\_ids](#input\_security\_group\_ids)                                                                                                                          | The list of VPC security groups IDs to attach                                                                                                                                          | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `[]`                                                                                     |    no    |
| <a name="input_domain_policy"></a> [domain\_policy](#input\_domain\_policy)                                                                                                                                           | Policy for OpenSearch domain                                                                                                                                                           | <pre>object({<br>  enabled     = optional(bool, false)<br>  actions     = optional(list(string), ["es:*"])<br>  not_actions = optional(list(string), null)<br>  principals = optional(list(object({<br/>    type        = string<br/>    identifiers = list(string)<br/>  })), [])<br/>  conditions = optional(list(object({<br/>    test     = string<br/>    variable = string<br/>    values   = list(string)<br/>  })), [])<br/>})</pre>                                                                                                                                                                                                                                             | `{}`                                                                                     |    no    |
| <a name="input_saml_enabled"></a> [saml\_enabled](#input\_saml\_enabled)                                                                                                                                              | Whether SAML authentication is enabled                                                                                                                                                 | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                  |    no    |
| <a name="input_saml_config"></a> [saml\_config](#input\_saml\_config)                                                                                                                                                 | SAML config                                                                                                                                                                            | <pre>object({<br>  idp_entity_id           = string<br>  idp_metadata_content    = string<br>  master_backend_role     = optional(string, null)<br>  master_user_name        = optional(string, null)<br>  roles_key               = optional(string, null)<br>  session_timeout_minutes = optional(number, null)<br>  subject_key             = optional(string, null)<br>})</pre>                                                                                                                                                                                                                                                                                                      | <pre>{<br>  "idp_entity_id": "",<br>  idp_metadata_content: ""<br>}</pre>                |    no    |
| <a name="input_inbound_outbound_connections_config"></a> [inbound\_outbound\_connections\_config](#input\_inbound\_outbound\_connections\_config)                                                                     | Configuration for AWS Opensearch Outbound Connection & AWS Opensearch Inbound Connection Accepter                                                                                      | <pre>list(object({<br/>  outbound_connection_enabled         = bool<br/>  inbound_connection_accepter_enabled = bool<br/>  owner_id                            = string<br/>  region                              = string<br/>  domain_name                         = string<br/>}))</pre>                                                                                                                                                                                                                                                                                                                                                                                              | `[]`                                                                                     |    no    |

## Outputs

| Name                                                                                         | Description                                                                     |
|----------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
| <a name="output_arn"></a> [arn](#output\_arn)                                                | The Amazon Resource Name (ARN) of the OpenSearch domain                         |
| <a name="output_domain_id"></a> [domain\_id](#output\_domain\_id)                            | Unique identifier for the domain                                                |
| <a name="output_domain_name"></a> [domain\_name](#output\_domain\_name)                      | Name of the OpenSearch domain                                                   |
| <a name="output_endpoint"></a> [endpoint](#output\_endpoint)                                 | Domain-specific endpoint used to submit index, search, and data upload requests |
| <a name="output_dashboard_endpoint"></a> [dashboard\_endpoint](#output\_dashboard\_endpoint) | Domain-specific endpoint for Dashboard without https scheme                     |
<!-- END_TF_DOCS -->

## License

Apache 2 Licensed. For more information please see [LICENSE](https://github.com/data-platform-hq/terraform-azurerm-linux-web-app/tree/main/LICENSE)
